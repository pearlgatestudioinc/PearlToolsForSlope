<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pearl Tools For Slopes</title>
    <link
      rel="icon"
      href="./Icons/Pearl Gate StudioNoSubtext.ico"
      type="image/x-icon"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 5px;
      }

      #container {
        margin-top: 20px;
        width: 200px; /* Ensure consistent width for both containers */
      }
      #Slopes,
      #PositionOverDistance,
      #ElevationPoints,
      #DistanceForPoints {
        display: inline-block; /* Display the containers side by side */
        vertical-align: top; /* Align them to the top */
        margin-right: 20px; /* Add some spacing between the columns */
        width: 200px; /* Ensure consistent width for both containers */
      }

      .textbox-wrapper {
        display: flex; /* Use inline-flex to keep elements in a row */
        align-items: center;
        margin-bottom: 10px; /* Add spacing between rows */
      }

      .textbox-wrapper label {
        width: 15px; /* Fixed width for label */
        margin-right: 10px; /* Ensure consistent spacing between label and textbox */
      }

      #DistanceForPoints .textbox-wrapper label {
        width: 20px; /* Fixed width for label */
        margin-right: 10px; /* Ensure consistent spacing between label and textbox */
      }

      #PositionOverDistance .textbox-wrapper label {
        width: 20px; /* Fixed width for label */
        margin-right: 10px; /* Ensure consistent spacing between label and textbox */
      }
      .textbox-wrapper input {
        width: 60px;
        height: 30px;
      }

      .switch-button {
        background: url("./Icons/btn_refresh_f.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
        padding-left: 20px;
      }
      .switch-button:hover {
        opacity: 0.8; /* Add a hover effect for better interactivity */
      }

      .btnDelete {
        background: url("./Icons/btn_colse_f.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
      }

      .btnDelete:hover {
        opacity: 0.8; /* Add a hover effect for better interactivity */
      }

      .toggleButton_PointAEdit {
        background: url("./Icons/btn_up_n.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
      }

      .toggleButton_PointAEdit:hover {
        opacity: 0.8; /* Add a hover effect for better interactivity */
      }
      .toggleButton_DistanceEdit {
        background: url("./Icons/btn_next_n.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
      }
      .toggleButton_DistanceEdit:hover {
        opacity: 0.8; /* Add a hover effect for better interactivity */
      }

      #addButton {
        display: block; /* Make the button appear as a block element */
        margin-bottom: 20px; /* Add spacing below the button */
      }

      @media (max-width: 480px) {
        #ElevationPoints,
        #DistanceForPoints {
          display: inline-block;
          margin-right: 5px; /* Reduce margin for smaller screens */
          width: 48%; /* Slightly reduce width to prevent wrapping */
          vertical-align: top;
        }
      }

      @media (max-width: 480px) {
        #Slopes,
        #PositionOverDistance {
          display: inline-block;
          margin-right: 5px; /* Reduce margin for smaller screens */
          width: 48%; /* Slightly reduce width to prevent wrapping */
          vertical-align: top;
        }
      }

      .toggleButton_PointAEdit.active {
        background: url("./Icons/btn_up_f.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
      }

      .toggleButton_DistanceEdit.active {
        background: url("./Icons/btn_next_f.png") no-repeat center center;
        background-size: contain;
        border: none;
        width: 40px;
        height: 40px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h1>Pearl Gate Studio - Pearl Tools For Slope</h1>
    <button id="addButton">Add Textbox</button>
    <div id="ElevationPoints"><b>ElevationPoints</b></div>
    <div id="DistanceForPoints"><b>DistanceForPoints</b></div>
    <div id="Slopes"><b>Slopes</b></div>
    <div id="PositionOverDistance"><b>Position Over Distance</b></div>

    <script>
      const container = document.getElementById("ElevationPoints");
      const DistanceForPoints = document.getElementById("DistanceForPoints");
      const PositionOverDistance = document.getElementById(
        "PositionOverDistance"
      );
      const slopesContainer = document.getElementById("Slopes");
      const addButton = document.getElementById("addButton");
      let activeSlopeToggleButton = null; // Track the active slope toggle button
      // Global arrays to store references to textboxes
      const elevationPointsTextboxes = [];
      const distanceForPointsTextboxes = [];
      const slopesTextboxes = [];
      const positionOverDistanceTextboxes = [];

      let count = 0; // Start count for textboxes
      const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"; // Alphabet for labels

      initialize();

      function initialize() {
        addButton.addEventListener("click", () => {
          if (count === 0) {
            createTextboxWrapper(); // Create the first textbox
            createTextboxWrapper(); // Create the second textbox
            createDistanceTextBoxWrapper(); // Create the first distance textbox
            CreateSlopesTextBoxWrapper();
            CreatePositionOverDistanceTextBoxWrapper();
          } else {
            createTextboxWrapper(); // Create one textbox for subsequent clicks
            createDistanceTextBoxWrapper(); // Create one distance textbox for subsequent clicks
            CreateSlopesTextBoxWrapper();
            CreatePositionOverDistanceTextBoxWrapper();
          }
        });
      }

      function createTextboxWrapper() {
        if (count >= alphabet.length) {
          alert("Maximum number of textboxes reached!");
          return;
        }

        const wrapper = document.createElement("div");
        wrapper.className = "textbox-wrapper";

        const label = document.createElement("label");
        label.textContent = `${alphabet[count]}:`;

        const textbox = document.createElement("input");
        textbox.type = "number";
        textbox.value = "0";

        wrapper.appendChild(label);
        wrapper.appendChild(textbox);

        // Add switch button
        if (count > 0) {
          const switchButton = document.createElement("button");
          switchButton.className = "switch-button";
          switchButton.addEventListener("click", () => {
            const previousWrapper = wrapper.previousElementSibling;
            if (previousWrapper) {
              const previousTextbox = previousWrapper.querySelector("input");
              if (previousTextbox) {
                const tempValue = previousTextbox.value;
                previousTextbox.value = textbox.value;
                textbox.value = tempValue;
              }
            }
          });
          wrapper.appendChild(switchButton);
        }

        // Add delete button
        if (count > 1) {
          const deleteButton = document.createElement("button");
          deleteButton.className = "btnDelete";
          deleteButton.addEventListener("click", () => {
            container.removeChild(wrapper);
            elevationPointsTextboxes.splice(count - 1, 1); // Remove from global array

            if (count > 2) {
              const distanceWrappers =
                DistanceForPoints.querySelectorAll(".textbox-wrapper");
              const lastDistanceWrapper =
                distanceWrappers[distanceWrappers.length - 1];
              if (lastDistanceWrapper) {
                DistanceForPoints.removeChild(lastDistanceWrapper);
                distanceForPointsTextboxes.pop(); // Remove from global array
              }

              const slopeWrappers =
                slopesContainer.querySelectorAll(".textbox-wrapper");
              const lastSlopeWrapper = slopeWrappers[slopeWrappers.length - 1];
              if (lastSlopeWrapper) {
                slopesContainer.removeChild(lastSlopeWrapper);
                slopesTextboxes.pop(); // Remove from global array
              }

              const positionWrappers =
                PositionOverDistance.querySelectorAll(".textbox-wrapper");
              const lastPositionWrapper =
                positionWrappers[positionWrappers.length - 1];
              if (lastPositionWrapper) {
                PositionOverDistance.removeChild(lastPositionWrapper);
                positionOverDistanceTextboxes.pop(); // Remove from global array
              }
            }

            count--;
            updateLabels();
          });
          wrapper.appendChild(deleteButton);
        }

        container.appendChild(wrapper);
        elevationPointsTextboxes.push(textbox); // Add to global array
        count++;
      }

      function createDistanceTextBoxWrapper() {
        if (count > 1) {
          const wrapper = document.createElement("div");
          wrapper.className = "textbox-wrapper";

          const label = document.createElement("label");
          label.textContent = `${alphabet[count - 2]}${alphabet[count - 1]}:`;

          const textbox = document.createElement("input");
          textbox.type = "number";
          textbox.value = "0";

          wrapper.appendChild(label);
          wrapper.appendChild(textbox);
          DistanceForPoints.appendChild(wrapper);
          distanceForPointsTextboxes.push(textbox); // Add to global array
        }
      }

      function CreateSlopesTextBoxWrapper() {
        if (count > 1) {
          const wrapper = document.createElement("div");
          wrapper.className = "textbox-wrapper";

          const label = document.createElement("label");
          label.textContent = `${alphabet[count - 2]}${alphabet[count - 1]}:`;

          const span = document.createElement("span");
          span.textContent = "0.00%";
          span.style.marginLeft = "10px";

          const textbox = document.createElement("input");
          textbox.type = "number";
          textbox.value = "0";
          textbox.readOnly = true;
          textbox.style.display = "none";

          // Create the slope toggle button
          const toggleButton_PointAEdit = document.createElement("button");
          toggleButton_PointAEdit.className = "toggleButton_PointAEdit";
          toggleButton_PointAEdit.addEventListener("click", () => {
            toggleEditMode(toggleButton_PointAEdit, textbox, span);
          });
          const toggleButton_DistanceEdit = document.createElement("button");
          toggleButton_DistanceEdit.className = "toggleButton_DistanceEdit";
          toggleButton_DistanceEdit.addEventListener("click", () => {
            toggleEditMode(toggleButton_DistanceEdit, textbox, span);
          });

          wrapper.appendChild(label);
          wrapper.appendChild(span);
          wrapper.appendChild(textbox);
          wrapper.appendChild(toggleButton_PointAEdit);
          wrapper.appendChild(toggleButton_DistanceEdit);
          slopesContainer.appendChild(wrapper);
          slopesTextboxes.push(textbox); // Add to global array
        }
      }

      function CreatePositionOverDistanceTextBoxWrapper() {
        if (count > 1) {
          const wrapper = document.createElement("div");
          wrapper.className = "textbox-wrapper";

          const label = document.createElement("label");
          label.textContent = `${alphabet[count - 2]}${alphabet[count - 1]}:`;

          const textbox = document.createElement("input");
          textbox.type = "number";
          textbox.value = "0";
          textbox.style.marginRight = "10px";

          const ofText = document.createElement("span");
          ofText.textContent = "of";

          const distanceValue = document.createElement("i");
          distanceValue.textContent = getDistanceValue(count - 2);
          distanceValue.style.marginLeft = "5px";

          wrapper.appendChild(label);
          wrapper.appendChild(textbox);
          wrapper.appendChild(ofText);
          wrapper.appendChild(distanceValue);
          PositionOverDistance.appendChild(wrapper);
          positionOverDistanceTextboxes.push(textbox); // Add to global array
        }
      }

      function updateLabels() {
        const wrappers = container.querySelectorAll(".textbox-wrapper");
        wrappers.forEach((wrapper, index) => {
          const label = wrapper.querySelector("label");
          label.textContent = `${alphabet[index]}:`;
        });

        updateDistanceLabels();
      }

      function updateDistanceLabels() {
        const wrappers = DistanceForPoints.querySelectorAll(".textbox-wrapper");
        wrappers.forEach((wrapper, index) => {
          const label = wrapper.querySelector("label");
          label.textContent = `${alphabet[index]}${alphabet[index + 1]}:`;
        });
      }

      function getDistanceValue(index) {
        if (index < distanceForPointsTextboxes.length) {
          return distanceForPointsTextboxes[index]?.valueAsNumber || 0;
        }
        return 0;
      }

      function toggleEditMode(
        toggleButton,
        textbox,
        span,
        activeImage,
        inactiveImage
      ) {
        if (
          activeSlopeToggleButton == null ||
          activeSlopeToggleButton == toggleButton
        ) {
          // Check if the button is in active mode
          const isActive = toggleButton.classList.contains("active");

          if (isActive) {
            // Disable edit mode
            toggleButton.classList.remove("active");
            textbox.style.display = "none";
            textbox.readOnly = true;
            activeSlopeToggleButton = null; // Reset the active button
            // Update the span with the textbox value
            span.textContent = `${textbox.value}%`;
            span.style.display = "inline";
          } else {
            // Enable edit mode
            toggleButton.classList.add("active");
            textbox.style.display = "inline";
            textbox.readOnly = false;
            activeSlopeToggleButton = toggleButton; // Set the active button
            // Hide the span while editing
            span.style.display = "none";
          }
        }
      }
    </script>
  </body>
</html>
